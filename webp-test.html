<!DOCTYPE html>
<html>
<head>
    <title>WebP Export Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            max-width: 600px; 
            margin: 0 auto;
        }
        .result { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px; 
        }
        .success { 
            background: #d4edda; 
            color: #155724; 
            border: 1px solid #c3e6cb; 
        }
        .error { 
            background: #f8d7da; 
            color: #721c24; 
            border: 1px solid #f5c6cb; 
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        #preview {
            max-width: 200px;
            margin: 10px 0;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <h1>WebP Export Test</h1>
    <p>This test will check if your browser supports WebP export from canvas.</p>
    
    <button onclick="testWebPSupport()">Test WebP Support</button>
    <button onclick="createTestImage()">Create Test Image</button>
    <button onclick="exportAsPNG()">Export as PNG</button>
    <button onclick="exportAsJPEG()">Export as JPEG</button>
    <button onclick="exportAsWebP()">Export as WebP</button>
    
    <div id="results"></div>
    <canvas id="testCanvas" width="200" height="200" style="border: 1px solid #ccc; margin: 10px 0;"></canvas>
    <div>
        <h3>Preview:</h3>
        <img id="preview" style="display: none;" />
    </div>

    <script>
        let canvas, ctx;
        
        function init() {
            canvas = document.getElementById('testCanvas');
            ctx = canvas.getContext('2d');
            createTestImage();
        }
        
        function createTestImage() {
            // Create a simple test image
            ctx.fillStyle = '#ff6b6b';
            ctx.fillRect(0, 0, 200, 200);
            
            ctx.fillStyle = '#4ecdc4';
            ctx.fillRect(50, 50, 100, 100);
            
            ctx.fillStyle = '#45b7d1';
            ctx.beginPath();
            ctx.arc(100, 100, 30, 0, 2 * Math.PI);
            ctx.fill();
            
            ctx.fillStyle = '#f9ca24';
            ctx.font = '20px Arial';
            ctx.fillText('Test', 80, 60);
            
            showResult('Test image created', 'success');
        }
        
        function testWebPSupport() {
            const testCanvas = document.createElement('canvas');
            testCanvas.width = 2;
            testCanvas.height = 2;
            const testCtx = testCanvas.getContext('2d');
            
            testCtx.fillStyle = 'red';
            testCtx.fillRect(0, 0, 2, 2);
            
            const webpDataURL = testCanvas.toDataURL('image/webp', 0.8);
            
            if (webpDataURL.startsWith('data:image/webp')) {
                showResult('✅ WebP export is supported by your browser!', 'success');
            } else {
                showResult('❌ WebP export is NOT supported by your browser. Will fallback to PNG.', 'error');
            }
            
            console.log('WebP test result:', webpDataURL.substring(0, 50));
        }
        
        function exportAsPNG() {
            const dataURL = canvas.toDataURL('image/png');
            downloadFile(dataURL, 'test-image.png');
            showPreview(dataURL);
            showResult('Exported as PNG: ' + dataURL.substring(0, 50) + '...', 'success');
        }
        
        function exportAsJPEG() {
            const dataURL = canvas.toDataURL('image/jpeg', 0.8);
            downloadFile(dataURL, 'test-image.jpg');
            showPreview(dataURL);
            showResult('Exported as JPEG: ' + dataURL.substring(0, 50) + '...', 'success');
        }
        
        function exportAsWebP() {
            const dataURL = canvas.toDataURL('image/webp', 0.8);
            
            if (dataURL.startsWith('data:image/webp')) {
                downloadFile(dataURL, 'test-image.webp');
                showPreview(dataURL);
                showResult('✅ Exported as WebP: ' + dataURL.substring(0, 50) + '...', 'success');
            } else {
                showResult('❌ WebP export failed. Returned: ' + dataURL.substring(0, 50) + '...', 'error');
                // Fallback to PNG
                exportAsPNG();
            }
        }
        
        function downloadFile(dataURL, filename) {
            const link = document.createElement('a');
            link.download = filename;
            link.href = dataURL;
            link.click();
        }
        
        function showPreview(dataURL) {
            const preview = document.getElementById('preview');
            preview.src = dataURL;
            preview.style.display = 'block';
        }
        
        function showResult(message, type) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = message;
            results.appendChild(div);
        }
        
        // Initialize when page loads
        window.onload = init;
    </script>
</body>
</html> 